{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "install-test-schema.json",
  "title": "Install Test Data",
  "description": "Shared schema for fomod installer test cases (per-game files)",
  "definitions": {
    "selectedOption": {
      "type": "object",
      "properties": {
        "stepId": { "type": "integer" },
        "groupId": { "type": "integer" },
        "pluginIds": {
          "type": "array",
          "items": { "type": "integer" }
        }
      },
      "required": ["stepId", "groupId", "pluginIds"]
    },
    "instruction": {
      "type": "object",
      "properties": {
        "type": { "type": "string" },
        "source": { "type": "string" },
        "destination": { "type": "string" },
        "section": { "type": "string" },
        "key": { "type": "string" },
        "value": { "type": "string" },
        "priority": { "type": "integer" },
        "data": {
          "description": "Binary data for generatefile instruction"
        }
      },
      "required": ["type"]
    },
    "testCase": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable test case name"
        },
        "mod": { "type": "string" },
        "archiveFile": {
          "type": "string",
          "description": "Archive file name (located in TestData/Data/{game}/)"
        },
        "pluginPath": { "type": "string" },
        "appVersion": { "type": "string" },
        "gameVersion": { "type": "string" },
        "extenderVersion": { "type": "string" },
        "installedPlugins": {
          "type": "array",
          "items": { "type": "string" }
        },
        "dialogChoices": {
          "type": "array",
          "items": { "$ref": "#/definitions/selectedOption" }
        },
        "preset": {
          "description": "Preset configuration (any JSON structure)"
        },
        "validate": { "type": "boolean" },
        "expectedMessage": { "type": "string" },
        "expectedInstructions": {
          "type": "array",
          "items": { "$ref": "#/definitions/instruction" }
        }
      },
      "required": ["name", "mod", "archiveFile", "pluginPath", "expectedInstructions"]
    }
  },
  "type": "object",
  "properties": {
    "game": {
      "type": "string",
      "description": "Game identifier for this test file"
    },
    "stopPatterns": {
      "type": "array",
      "description": "Stop patterns for this game",
      "items": { "type": "string" }
    },
    "testCases": {
      "type": "array",
      "items": { "$ref": "#/definitions/testCase" }
    }
  },
  "required": ["game", "stopPatterns", "testCases"]
}
